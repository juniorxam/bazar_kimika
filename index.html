<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>BazarPlus - Gest√£o de Bazares e Cr√©ditos</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    
    <main class="main-content">
        <header class="header">
            <h1>BazarKimika - Gest√£o de Bazares e Cr√©ditos</h1>
            <div class="header-actions">
                <button class="theme-toggle" onclick="toggleTheme()">
                    <i class="fas fa-moon"></i>
                </button>
                <div class="user-info">
                    Ol√°, FRAN
                    <img src="https://via.placeholder.com/40/8b5cf6/ffffff?text=LP" alt="User Avatar">
                </div>
            </div>
        </header>

        <nav class="tab-nav">
            <button class="tab-button active" onclick="openTab(event, 'dashboard')"><i class="fas fa-chart-line"></i> Dashboard</button>
            <button class="tab-button" onclick="openTab(event, 'itens')"><i class="fas fa-tags"></i> Itens</button>
            <button class="tab-button" onclick="openTab(event, 'consignatarios')"><i class="fas fa-handshake"></i> Consignat√°rios</button>
            <button class="tab-button" onclick="openTab(event, 'compradores')"><i class="fas fa-users"></i> Compradores</button>
            <button class="tab-button" onclick="openTab(event, 'bazares')"><i class="fas fa-store"></i> Bazares</button>
            <button class="tab-button" onclick="openTab(event, 'vendas')"><i class="fas fa-cash-register"></i> Vendas</button>
            <button class="tab-button" onclick="openTab(event, 'consumos')"><i class="fas fa-credit-card"></i> Consumos (Cr√©dito)</button>
            <button class="tab-button" onclick="openTab(event, 'config')"><i class="fas fa-cogs"></i> Configura√ß√µes</button>
        </nav>

        <div id="dashboard" class="tab-content active">
            <h2>üìà Resumo e An√°lise</h2>
            
            <div class="filtros-container">
                <div class="form-group-inline">
                    <label for="filtroMesDashboard">M√™s:</label>
                    <select id="filtroMesDashboard">
                        <option value="">Todos</option>
                        <option value="1">Janeiro</option><option value="2">Fevereiro</option>
                        <option value="3">Mar√ßo</option><option value="4">Abril</option>
                        <option value="5">Maio</option><option value="6">Junho</option>
                        <option value="7">Julho</option><option value="8">Agosto</option>
                        <option value="9">Setembro</option><option value="10">Outubro</option>
                        <option value="11">Novembro</option><option value="12">Dezembro</option>
                    </select>
                </div>
                <div class="form-group-inline">
                    <label for="filtroBazarDashboard">Bazar:</label>
                    <select id="filtroBazarDashboard"></select>
                </div>
                <div class="form-group-inline">
                    <label for="filtroConsignatarioDashboard">Consignat√°rio:</label>
                    <select id="filtroConsignatarioDashboard"></select>
                </div>
                <button onclick="renderizarDashboard()" class="btn btn-secondary"><i class="fas fa-filter"></i> Aplicar Filtros</button>
            </div>

            <div class="dashboard-grid">
                <div class="card metric-card">
                    <i class="fas fa-dollar-sign text-purple"></i>
                    <h3>Total de Vendas</h3>
                    <p id="totalVendasDashboard" class="metric-value">R$ 0,00</p>
                </div>
                <div class="card metric-card">
                    <i class="fas fa-coins text-success"></i>
                    <h3>Cr√©ditos Gerados</h3>
                    <p id="creditosGeradosDashboard" class="metric-value">R$ 0,00</p>
                </div>
                <div class="card metric-card">
                    <i class="fas fa-wallet text-danger"></i>
                    <h3>Cr√©ditos Utilizados</h3>
                    <p id="creditosUtilizadosDashboard" class="metric-value">R$ 0,00</p>
                </div>
                <div class="card metric-card">
                    <i class="fas fa-box-open text-info"></i>
                    <h3>Itens em Estoque</h3>
                    <p id="itensEmEstoqueDashboard" class="metric-value">0</p>
                </div>
            </div>

            <div class="charts-container">
                <div class="card chart-card">
                    <h3>Vendas x Cr√©ditos (√öltimos Meses)</h3>
                    <canvas id="vendasCreditosChart"></canvas>
                </div>
                <div class="card chart-card">
                    <h3>Top 5 Consignat√°rios (Vendas)</h3>
                    <canvas id="topConsignatariosChart"></canvas>
                </div>
            </div>

            <div class="card table-card">
                <h3>√öltimas Vendas</h3>
                <div class="table-responsive">
                    <table class="data-table" id="ultimasVendasTable">
                        <thead>
                            <tr>
                                <th>Data</th>
                                <th>Comprador</th>
                                <th>Bazar</th>
                                <th>Valor</th>
                            </tr>
                        </thead>
                        <tbody>
                            </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="itens" class="tab-content">
            <h2>üè∑Ô∏è Cadastro de Itens</h2>

            <div class="card form-card">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="descricaoItem">Descri√ß√£o do Item</label>
                        <input type="text" id="descricaoItem" required>
                    </div>
                    <div class="form-group">
                        <label for="consignatarioItemId">Consignat√°rio</label>
                        <select id="consignatarioItemId" required></select>
                    </div>
                    <div class="form-group">
                        <label for="valorItem">Valor (R$)</label>
                        <input type="number" id="valorItem" min="0.01" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label for="quantidadeItem">Quantidade</label>
                        <input type="number" id="quantidadeItem" min="1" value="1" required>
                    </div>
                    <div class="form-group">
                        <label for="bazarItemId">Bazar Associado (Opcional)</label>
                        <select id="bazarItemId"></select>
                    </div>
                    <div class="form-group">
                        <label for="statusItem">Status</label>
                        <select id="statusItem" disabled>
                            <option value="Dispon√≠vel">Dispon√≠vel</option>
                            <option value="Vendido">Vendido</option>
                            <option value="Reservado">Reservado</option>
                        </select>
                    </div>
                </div>
                <div class="action-buttons">
                    <button onclick="adicionarItem()" class="btn btn-primary">
                        <i class="fas fa-plus"></i> Cadastrar Item
                    </button>
                </div>
            </div>

            <div class="card table-card">
                <h3>Estoque de Itens</h3>
                <div class="filtros-container">
                    <div class="form-group-inline">
                        <label for="filtroDescricaoItem">Descri√ß√£o:</label>
                        <input type="text" id="filtroDescricaoItem" oninput="renderizarItens()">
                    </div>
                    <div class="form-group-inline">
                        <label for="filtroConsignatarioItem">Consignat√°rio:</label>
                        <select id="filtroConsignatarioItem" onchange="renderizarItens()"></select>
                    </div>
                    <div class="form-group-inline">
                        <label for="filtroBazarItem">Bazar:</label>
                        <select id="filtroBazarItem" onchange="renderizarItens()"></select>
                    </div>
                    <div class="form-group-inline">
                        <label for="filtroStatusItem">Status:</label>
                        <select id="filtroStatusItem" onchange="renderizarItens()">
                            <option value="">Todos</option>
                            <option value="Dispon√≠vel">Dispon√≠vel</option>
                            <option value="Vendido">Vendido</option>
                            <option value="Reservado">Reservado</option>
                        </select>
                    </div>
                    <button onclick="limparFiltrosItens()" class="btn btn-secondary"><i class="fas fa-undo"></i> Limpar Filtros</button>
                </div>
                <div class="table-responsive">
                    <table class="data-table" id="itensTable">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Descri√ß√£o</th>
                                <th>Consignat√°rio</th>
                                <th>Valor</th>
                                <th>Qtd</th>
                                <th>Bazar</th>
                                <th>Status</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody>
                            </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <div id="consignatarios" class="tab-content">
            <h2>ü§ù Cadastro de Consignat√°rios</h2>

            <div class="card form-card">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="nomeConsignatario">Nome</label>
                        <input type="text" id="nomeConsignatario" required>
                    </div>
                    <div class="form-group">
                        <label for="telefoneConsignatario">Telefone (Opcional)</label>
                        <input type="tel" id="telefoneConsignatario">
                    </div>
                    <div class="form-group">
                        <label for="emailConsignatario">Email (Opcional)</label>
                        <input type="email" id="emailConsignatario">
                    </div>
                </div>
                <div class="action-buttons">
                    <button onclick="adicionarConsignatario()" class="btn btn-primary">
                        <i class="fas fa-user-plus"></i> Cadastrar Consignat√°rio
                    </button>
                </div>
            </div>

            <div class="card table-card">
                <h3>Lista de Consignat√°rios e Saldo de Cr√©ditos</h3>
                <div class="table-responsive">
                    <table class="data-table" id="consignatariosTable">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Nome</th>
                                <th>Telefone</th>
                                <th>Cr√©ditos (Saldo)</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody>
                            </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="compradores" class="tab-content">
            <h2>üë• Cadastro de Compradores (Clientes)</h2>

            <div class="card form-card">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="nomeComprador">Nome</label>
                        <input type="text" id="nomeComprador" required>
                    </div>
                    <div class="form-group">
                        <label for="telefoneComprador">Telefone (Opcional)</label>
                        <input type="tel" id="telefoneComprador">
                    </div>
                </div>
                <div class="action-buttons">
                    <button onclick="adicionarComprador()" class="btn btn-primary">
                        <i class="fas fa-user-plus"></i> Cadastrar Comprador
                    </button>
                </div>
            </div>

            <div class="card table-card">
                <h3>Lista de Clientes Compradores</h3>
                <div class="table-responsive">
                    <table class="data-table" id="compradoresTable">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Nome</th>
                                <th>Telefone</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody>
                            </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="bazares" class="tab-content">
            <h2>üè¨ Cadastro de Bazares</h2>

            <div class="card form-card">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="nomeBazar">Nome do Bazar</label>
                        <input type="text" id="nomeBazar" required>
                    </div>
                    <div class="form-group">
                        <label for="dataInicioBazar">Data de In√≠cio</label>
                        <input type="date" id="dataInicioBazar" required>
                    </div>
                    <div class="form-group">
                        <label for="dataFimBazar">Data de Fim (Opcional)</label>
                        <input type="date" id="dataFimBazar">
                    </div>
                </div>
                <div class="action-buttons">
                    <button onclick="criarBazar()" class="btn btn-primary">
                        <i class="fas fa-plus"></i> Criar Bazar
                    </button>
                </div>
            </div>

            <div class="card table-card">
                <h3>Bazares Cadastrados</h3>
                <div class="table-responsive">
                    <table class="data-table" id="bazaresTable">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Nome</th>
                                <th>In√≠cio</th>
                                <th>Fim</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody>
                            </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <div id="vendas" class="tab-content">
            <h2>üíµ Registro de Vendas</h2>

            <div class="card form-card">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="itemVendidoId">Item Vendido</label>
                        <select id="itemVendidoId" onchange="preencherValorVenda()" required></select>
                    </div>
                    <div class="form-group">
                        <label for="valorVenda">Valor da Venda (R$)</label>
                        <input type="number" id="valorVenda" min="0.01" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label for="compradorVendaId">Comprador</label>
                        <select id="compradorVendaId" required></select>
                    </div>
                    <div class="form-group">
                        <label for="bazarVendaId">Bazar da Venda</label>
                        <select id="bazarVendaId" required></select>
                    </div>
                    <div class="form-group">
                        <label for="dataVenda">Data da Venda</label>
                        <input type="date" id="dataVenda" required>
                    </div>
                    <div class="form-group">
                        <label for="formaPagamentoVenda">Forma de Pagamento</label>
                        <select id="formaPagamentoVenda" required>
                            <option value="PIX">PIX</option>
                            <option value="Cartao">Cart√£o</option>
                            <option value="Dinheiro">Dinheiro</option>
                            <option value="Outro">Outro</option>
                        </select>
                    </div>
                </div>
                <div class="action-buttons">
                    <button onclick="registrarVenda()" class="btn btn-primary">
                        <i class="fas fa-check-circle"></i> Registrar Venda
                    </button>
                </div>
            </div>

            <div class="card table-card">
                <h3>Hist√≥rico de Vendas</h3>
                <div class="filtros-container">
                    <div class="form-group-inline">
                        <label for="filtroDataInicialVenda">De:</label>
                        <input type="date" id="filtroDataInicialVenda" onchange="renderizarVendas()">
                    </div>
                    <div class="form-group-inline">
                        <label for="filtroDataFinalVenda">At√©:</label>
                        <input type="date" id="filtroDataFinalVenda" onchange="renderizarVendas()">
                    </div>
                    <div class="form-group-inline">
                        <label for="filtroBazarVenda">Bazar:</label>
                        <select id="filtroBazarVenda" onchange="renderizarVendas()"></select>
                    </div>
                    <div class="form-group-inline">
                        <label for="filtroConsignatarioVenda">Consignat√°rio:</label>
                        <select id="filtroConsignatarioVenda" onchange="renderizarVendas()"></select>
                    </div>
                    <div class="form-group-inline">
                        <label for="filtroCompradorVenda">Comprador:</label>
                        <select id="filtroCompradorVenda" onchange="renderizarVendas()">
                            <option value="">Todos</option>
                            </select>
                    </div>
                    <button onclick="limparFiltrosVendas()" class="btn btn-secondary"><i class="fas fa-undo"></i> Limpar Filtros</button>
                    <button onclick="gerarRelatorioVendas()" class="btn btn-tertiary"><i class="fas fa-file-pdf"></i> Gerar Relat√≥rio</button>
                </div>
                <div class="table-responsive">
                    <table class="data-table" id="vendasTable">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Data</th>
                                <th>Item</th>
                                <th>Consignat√°rio</th>
                                <th>Comprador</th>
                                <th>Valor Venda</th>
                                <th>Cr√©dito Gerado</th>
                                <th>Bazar</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody>
                            </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="consumos" class="tab-content">
            <h2>üí≥ Uso de Cr√©dito (Consignat√°rios)</h2>

            <div class="card form-card">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="consignatarioConsumoId">Consignat√°rio</label>
                        <select id="consignatarioConsumoId" onchange="atualizarSaldoConsignatario()" required></select>
                    </div>
                    <div class="form-group">
                        <label for="saldoConsignatario">Saldo Atual</label>
                        <input type="text" id="saldoConsignatario" value="R$ 0,00" disabled>
                    </div>
                    <div class="form-group">
                        <label for="valorConsumo">Valor do Consumo (R$)</label>
                        <input type="number" id="valorConsumo" min="0.01" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label for="descricaoConsumo">Descri√ß√£o/Motivo</label>
                        <input type="text" id="descricaoConsumo" required>
                    </div>
                    <div class="form-group">
                        <label for="dataConsumo">Data do Consumo</label>
                        <input type="date" id="dataConsumo" required>
                    </div>
                </div>
                <div class="action-buttons">
                    <button onclick="registrarConsumo()" class="btn btn-danger">
                        <i class="fas fa-minus-circle"></i> Registrar Uso de Cr√©dito
                    </button>
                </div>
            </div>

            <div class="card table-card">
                <h3>Hist√≥rico de Uso de Cr√©dito</h3>
                <div class="filtros-container">
                    <div class="form-group-inline">
                        <label for="filtroDataInicialConsumo">De:</label>
                        <input type="date" id="filtroDataInicialConsumo" onchange="renderizarConsumos()">
                    </div>
                    <div class="form-group-inline">
                        <label for="filtroDataFinalConsumo">At√©:</label>
                        <input type="date" id="filtroDataFinalConsumo" onchange="renderizarConsumos()">
                    </div>
                    <div class="form-group-inline">
                        <label for="filtroConsignatarioConsumo">Consignat√°rio:</label>
                        <select id="filtroConsignatarioConsumo" onchange="renderizarConsumos()"></select>
                    </div>
                    <button onclick="limparFiltrosConsumos()" class="btn btn-secondary"><i class="fas fa-undo"></i> Limpar Filtros</button>
                </div>
                <div class="table-responsive">
                    <table class="data-table" id="consumosTable">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Data</th>
                                <th>Consignat√°rio</th>
                                <th>Descri√ß√£o</th>
                                <th>Valor Consumido</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody>
                            </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="config" class="tab-content">
            <h2>‚öôÔ∏è Configura√ß√µes do Sistema</h2>

            <div class="card form-card">
                <h3>Par√¢metros Financeiros e de Estoque</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="percentualConsignatario">Percentual Consignat√°rio (%)</label>
                        <input type="number" id="percentualConsignatario" min="0" max="100" value="80" required>
                    </div>
                    <div class="form-group">
                        <label for="percentualLoja">Percentual Loja (%)</label>
                        <input type="number" id="percentualLoja" min="0" max="100" value="20" required>
                    </div>
                    <div class="form-group">
                        <label for="validadeCredito">Validade do Cr√©dito (Meses)</label>
                        <input type="number" id="validadeCredito" min="1" value="6" required>
                    </div>
                    <div class="form-group">
                        <label for="alertaEstoque">Alerta de Estoque Baixo (Itens)</label>
                        <input type="number" id="alertaEstoque" min="1" value="5" required>
                    </div>
                </div>
                <div class="action-buttons">
                    <button onclick="salvarConfiguracoes()" class="btn btn-primary">
                        <i class="fas fa-save"></i> Salvar Configura√ß√µes
                    </button>
                </div>
            </div>

            <div class="card form-card">
                <h3>Apar√™ncia e Backup</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="temaSistema">Tema</label>
                        <select id="temaSistema" onchange="mudarTemaSistema()">
                            <option value="light">Claro</option>
                            <option value="dark">Escuro</option>
                        </select>
                    </div>
                </div>
                <div class="action-buttons">
                    <button onclick="exportarDados()" class="btn btn-secondary"><i class="fas fa-download"></i> Exportar/Backup (JSON)</button>
                    <button onclick="iniciarImportacaoGeral()" class="btn btn-tertiary"><i class="fas fa-upload"></i> Importar/Restaurar (JSON)</button>
                    <button onclick="limparTudo()" class="btn btn-danger"><i class="fas fa-eraser"></i> Limpar TODOS os Dados</button>
                </div>
            </div>
        </div>
    </main>

    <div id="notification-area"></div>
    <input type="file" id="importFile" accept="application/json" style="display: none;" onchange="processarImportacao(event)">
    <script src="script.js"></script>

</body>
</html>
