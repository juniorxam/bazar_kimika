<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>BazarPlus - Gest√£o de Bazares e Cr√©ditos</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css"> 
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
</head>
<body>
    
    <main class="main-content">
        <header class="header">
            <h1>BazarKimika - Gest√£o de Bazares e Cr√©ditos</h1>
            <div class="header-actions">
                <button class="theme-toggle" onclick="toggleTheme()">
                    <i class="fas fa-moon"></i>
                </button>
                <div class="user-info">
                    Ol√°, FRAN
                    <img src="https://via.placeholder.com/40/8b5cf6/ffffff?text=LP" alt="User Avatar">
                </div>
            </div>
        </header>

        <nav class="tab-nav">
            <button class="tab-button active" onclick="openTab(event, 'dashboard')"><i class="fas fa-chart-line"></i> Dashboard</button>
            <button class="tab-button" onclick="openTab(event, 'bazares')"><i class="fas fa-store"></i> Bazares</button>
            <button class="tab-button" onclick="openTab(event, 'itens')"><i class="fas fa-tags"></i> Itens</button>
            <button class="tab-button" onclick="openTab(event, 'consignatarios')"><i class="fas fa-handshake"></i> Consignat√°rios</button>
            <button class="tab-button" onclick="openTab(event, 'compradores')"><i class="fas fa-users"></i> Compradores</button>
            <button class="tab-button" onclick="openTab(event, 'vendas')"><i class="fas fa-shopping-cart"></i> Vendas</button>
            <button class="tab-button" onclick="openTab(event, 'consumos')"><i class="fas fa-coins"></i> Consumos</button>
            <button class="tab-button" onclick="openTab(event, 'config')"><i class="fas fa-cogs"></i> Configura√ß√µes</button>
        </nav>

        <div id="dashboard" class="tab-content active">
            <h2>üìä Dashboard de Vis√£o Geral</h2>
            <div class="dashboard-controls">
                <select id="filtroMesDashboard" onchange="renderizarDashboard()"></select>
                <select id="filtroBazarDashboard" onchange="renderizarDashboard()"></select>
                <select id="filtroConsignatarioDashboard" onchange="renderizarDashboard()"></select>
            </div>
            
            <div class="dashboard-grid">
                <div class="card stat-card primary">
                    <h3>Total de Vendas</h3>
                    <p id="totalVendasDashboard">R$ 0,00</p>
                </div>
                <div class="card stat-card success">
                    <h3>Cr√©ditos Gerados</h3>
                    <p id="creditosGeradosDashboard">R$ 0,00</p>
                </div>
                <div class="card stat-card info">
                    <h3>Cr√©ditos Utilizados</h3>
                    <p id="creditosUtilizadosDashboard">R$ 0,00</p>
                </div>
                <div class="card stat-card danger">
                    <h3>Itens em Estoque</h3>
                    <p id="itensEmEstoqueDashboard">0</p>
                </div>
            </div>

            <div class="charts-container">
                <div class="card chart-card">
                    <h3>Vendas e Cr√©ditos (√öltimos 6 Meses)</h3>
                    <canvas id="vendasCreditosChart"></canvas>
                </div>
                <div class="card chart-card">
                    <h3>Top 5 Consignat√°rios por Vendas</h3>
                    <canvas id="topConsignatariosChart"></canvas>
                </div>
            </div>

            <div class="card table-card">
                <h3>√öltimas Vendas</h3>
                <div class="table-responsive">
                    <table id="ultimasVendasTable">
                        <thead>
                            <tr>
                                <th>Data</th>
                                <th>Comprador</th>
                                <th>Bazar</th>
                                <th>Valor</th>
                            </tr>
                        </thead>
                        <tbody>
                            </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="bazares" class="tab-content">
            <h2>üõçÔ∏è Gest√£o de Bazares</h2>
            <div class="card">
                <h3>Criar Novo Bazar</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="nomeBazar">Nome do Bazar</label>
                        <input type="text" id="nomeBazar" required>
                    </div>
                    <div class="form-group">
                        <label for="dataInicioBazar">Data de In√≠cio</label>
                        <input type="date" id="dataInicioBazar" required>
                    </div>
                    <div class="form-group">
                        <label for="dataFimBazar">Data de Fim (Opcional)</label>
                        <input type="date" id="dataFimBazar">
                    </div>
                </div>
                <div class="action-buttons">
                    <button onclick="criarBazar()" class="btn btn-primary"><i class="fas fa-plus"></i> Criar Bazar</button>
                    <button onclick="exportarBazares()" class="btn btn-export"><i class="fas fa-file-export"></i> Exportar</button>
                    <button onclick="iniciarImportacao('bazares')" class="btn btn-import"><i class="fas fa-file-import"></i> Importar</button>
                </div>
            </div>
            
            <div class="card">
                <h3>Lista de Bazares</h3>
                <div class="table-responsive">
                    <table id="bazaresTable">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Nome</th>
                                <th>In√≠cio</th>
                                <th>Fim</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody>
                            </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <div id="itens" class="tab-content">
            <h2>üè∑Ô∏è Gest√£o de Itens (Estoque)</h2>
            <div class="card">
                <h3>Adicionar Novo Item</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="descricaoItem">Descri√ß√£o</label>
                        <input type="text" id="descricaoItem" required>
                    </div>
                    <div class="form-group">
                        <label for="consignatarioItemId">Consignat√°rio</label>
                        <select id="consignatarioItemId" required></select>
                    </div>
                    <div class="form-group">
                        <label for="valorItem">Valor (R$)</label>
                        <input type="number" id="valorItem" min="0.01" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label for="quantidadeItem">Quantidade</label>
                        <input type="number" id="quantidadeItem" min="1" required>
                    </div>
                    <div class="form-group">
                        <label for="bazarItemId">Bazar</label>
                        <select id="bazarItemId" required></select>
                    </div>
                    <div class="form-group">
                        <label for="statusItem">Status</label>
                        <select id="statusItem" required>
                            <option value="Dispon√≠vel">Dispon√≠vel</option>
                            <option value="Vendido">Vendido</option>
                            <option value="Reservado">Reservado</option>
                        </select>
                    </div>
                </div>
                <div class="action-buttons">
                    <button onclick="adicionarItem()" class="btn btn-primary"><i class="fas fa-plus"></i> Adicionar Item</button>
                    <button onclick="exportarItens()" class="btn btn-export"><i class="fas fa-file-export"></i> Exportar</button>
                    <button onclick="iniciarImportacao('itens')" class="btn btn-import"><i class="fas fa-file-import"></i> Importar</button>
                </div>
            </div>
            
            <div class="card">
                <h3>Lista de Itens</h3>
                <div class="filtros-container">
                    <input type="text" id="filtroDescricaoItem" onkeyup="renderizarItens()" placeholder="Filtrar por Descri√ß√£o">
                    <select id="filtroConsignatarioItem" onchange="renderizarItens()"></select>
                    <select id="filtroBazarItem" onchange="renderizarItens()"></select>
                    <select id="filtroStatusItem" onchange="renderizarItens()">
                        <option value="">Todos os Status</option>
                        <option value="Dispon√≠vel">Dispon√≠vel</option>
                        <option value="Vendido">Vendido</option>
                        <option value="Reservado">Reservado</option>
                    </select>
                    <button onclick="limparFiltrosItens()" class="btn btn-secondary"><i class="fas fa-broom"></i> Limpar Filtros</button>
                </div>
                <div class="table-responsive">
                    <table id="itensTable">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Descri√ß√£o</th>
                                <th>Consignat√°rio</th>
                                <th>Valor</th>
                                <th>Qtd</th>
                                <th>Bazar</th>
                                <th>Status</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody>
                            </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="consignatarios" class="tab-content">
            <h2>ü§ù Gest√£o de Consignat√°rios</h2>
            <div class="card">
                <h3>Cadastrar Novo Consignat√°rio</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="nomeConsignatario">Nome</label>
                        <input type="text" id="nomeConsignatario" required>
                    </div>
                    <div class="form-group">
                        <label for="telefoneConsignatario">Telefone</label>
                        <input type="tel" id="telefoneConsignatario">
                    </div>
                    <div class="form-group">
                        <label for="emailConsignatario">Email</label>
                        <input type="email" id="emailConsignatario">
                    </div>
                </div>
                <div class="action-buttons">
                    <button onclick="adicionarConsignatario()" class="btn btn-primary"><i class="fas fa-user-plus"></i> Cadastrar</button>
                    <button onclick="exportarConsignatarios()" class="btn btn-export"><i class="fas fa-file-export"></i> Exportar</button>
                    <button onclick="iniciarImportacao('consignatarios')" class="btn btn-import"><i class="fas fa-file-import"></i> Importar</button>
                </div>
            </div>
            
            <div class="card">
                <h3>Lista de Consignat√°rios</h3>
                <div class="table-responsive">
                    <table id="consignatariosTable">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Nome</th>
                                <th>Telefone</th>
                                <th>Cr√©dito</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody>
                            </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="compradores" class="tab-content">
            <h2>üë§ Gest√£o de Compradores</h2>
            <div class="card">
                <h3>Cadastrar Novo Comprador</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="nomeComprador">Nome</label>
                        <input type="text" id="nomeComprador" required>
                    </div>
                    <div class="form-group">
                        <label for="telefoneComprador">Telefone</label>
                        <input type="tel" id="telefoneComprador">
                    </div>
                </div>
                <div class="action-buttons">
                    <button onclick="adicionarComprador()" class="btn btn-primary"><i class="fas fa-user-plus"></i> Cadastrar</button>
                    <button onclick="exportarCompradores()" class="btn btn-export"><i class="fas fa-file-export"></i> Exportar</button>
                    <button onclick="iniciarImportacao('compradores')" class="btn btn-import"><i class="fas fa-file-import"></i> Importar</button>
                </div>
            </div>
            
            <div class="card">
                <h3>Lista de Compradores</h3>
                <div class="table-responsive">
                    <table id="compradoresTable">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Nome</th>
                                <th>Telefone</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody>
                            </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="vendas" class="tab-content">
            <h2>üõí Registro de Vendas</h2>
            <div class="card">
                <h3>Registrar Nova Venda</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="compradorVendaId">Comprador</label>
                        <select id="compradorVendaId" required></select>
                    </div>
                    <div class="form-group">
                        <label for="bazarVendaId">Bazar</label>
                        <select id="bazarVendaId" required></select>
                    </div>
                    <div class="form-group">
                        <label for="itemVendidoId">Item Vendido</label>
                        <select id="itemVendidoId" onchange="preencherValorVenda()" required></select>
                    </div>
                    <div class="form-group">
                        <label for="valorVenda">Valor da Venda (R$)</label>
                        <input type="number" id="valorVenda" min="0.01" step="0.01" required readonly>
                    </div>
                    <div class="form-group">
                        <label for="dataVenda">Data da Venda</label>
                        <input type="date" id="dataVenda" required>
                    </div>
                    <div class="form-group">
                        <label for="formaPagamentoVenda">Forma de Pagamento</label>
                        <select id="formaPagamentoVenda" required>
                            <option value="Dinheiro">Dinheiro</option>
                            <option value="Cart√£o">Cart√£o</option>
                            <option value="Pix">Pix</option>
                        </select>
                    </div>
                </div>
                <div class="action-buttons">
                    <button onclick="registrarVenda()" class="btn btn-primary"><i class="fas fa-cash-register"></i> Registrar Venda</button>
                </div>
            </div>
            
            <div class="card">
                <h3>Hist√≥rico de Vendas</h3>
                <div class="filtros-container">
                    <select id="filtroBazarVenda" onchange="renderizarVendas()"></select>
                    <select id="filtroConsignatarioVenda" onchange="renderizarVendas()"></select>
                    <select id="filtroCompradorVenda" onchange="renderizarVendas()"></select>
                    <input type="date" id="filtroDataInicialVenda" onchange="renderizarVendas()">
                    <input type="date" id="filtroDataFinalVenda" onchange="renderizarVendas()">
                    <button onclick="limparFiltrosVendas()" class="btn btn-secondary"><i class="fas fa-broom"></i> Limpar Filtros</button>
                    <button onclick="gerarRelatorioVendas()" class="btn btn-export"><i class="fas fa-file-pdf"></i> Gerar Relat√≥rio</button>
                </div>
                <div class="table-responsive">
                    <table id="vendasTable">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Data</th>
                                <th>Item</th>
                                <th>Consignat√°rio</th>
                                <th>Comprador</th>
                                <th>Valor</th>
                                <th>Cr√©dito Gerado</th>
                                <th>Bazar</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody>
                            </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <div id="consumos" class="tab-content">
            <h2>üí∞ Uso de Cr√©ditos (Consumos)</h2>
            <div class="card">
                <h3>Registrar Uso de Cr√©dito</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="consignatarioConsumoId">Consignat√°rio (Quem usou o cr√©dito)</label>
                        <select id="consignatarioConsumoId" required onchange="atualizarSaldoConsignatario()"></select>
                    </div>
                    <div class="form-group">
                        <label for="saldoConsignatario">Saldo de Cr√©dito Dispon√≠vel (R$)</label>
                        <input type="text" id="saldoConsignatario" readonly value="R$ 0,00">
                    </div>
                    <div class="form-group">
                        <label for="valorConsumo">Valor do Consumo (R$)</label>
                        <input type="number" id="valorConsumo" min="0.01" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label for="dataConsumo">Data do Consumo</label>
                        <input type="date" id="dataConsumo" required>
                    </div>
                    <div class="form-group full-width">
                        <label for="descricaoConsumo">Descri√ß√£o/Motivo</label>
                        <input type="text" id="descricaoConsumo" required>
                    </div>
                </div>
                <div class="action-buttons">
                    <button onclick="registrarConsumo()" class="btn btn-primary"><i class="fas fa-minus-circle"></i> Registrar Consumo</button>
                </div>
            </div>
            
            <div class="card">
                <h3>Hist√≥rico de Consumos (Uso de Cr√©dito)</h3>
                <div class="filtros-container">
                    <select id="filtroConsignatarioConsumo" onchange="renderizarConsumos()"></select>
                    <input type="date" id="filtroDataInicialConsumo" onchange="renderizarConsumos()">
                    <input type="date" id="filtroDataFinalConsumo" onchange="renderizarConsumos()">
                    <button onclick="limparFiltrosConsumos()" class="btn btn-secondary"><i class="fas fa-broom"></i> Limpar Filtros</button>
                </div>
                <div class="table-responsive">
                    <table id="consumosTable">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Data</th>
                                <th>Consignat√°rio</th>
                                <th>Descri√ß√£o</th>
                                <th>Valor</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody>
                            </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="config" class="tab-content">
            <h2>‚öôÔ∏è Configura√ß√µes do Sistema</h2>
            <div class="card">
                <h3>Prefer√™ncias de Tema</h3>
                <div class="form-group">
                    <label for="temaSistema">Tema</label>
                    <select id="temaSistema" onchange="mudarTemaSistema()">
                        <option value="light">Claro</option>
                        <option value="dark">Escuro</option>
                    </select>
                </div>
            </div>

            <div class="card">
                <h3>Backup de Dados</h3>
                <div class="action-buttons">
                    <button onclick="exportarDados()" class="btn btn-export"><i class="fas fa-download"></i> Fazer Backup (JSON)</button>
                    <button onclick="iniciarImportacaoGeral()" class="btn btn-import"><i class="fas fa-upload"></i> Restaurar Backup (JSON)</button>
                    <p class="small-info">Isso exporta/restaura todos os dados (Bazares, Itens, Clientes, Vendas, Consumos).</p>
                </div>
            </div>

            <div class="card">
                <h3>Par√¢metros Financeiros e Operacionais</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="percentualConsignatario">Percentual Consignat√°rio (%)</label>
                        <input type="number" id="percentualConsignatario" min="0" max="100" value="80" required>
                    </div>
                    <div class="form-group">
                        <label for="percentualLoja">Percentual Loja (%)</label>
                        <input type="number" id="percentualLoja" min="0" max="100" value="20" required>
                    </div>
                    <div class="form-group">
                        <label for="validadeCredito">Validade do Cr√©dito (Meses)</label>
                        <input type="number" id="validadeCredito" min="1" value="6" required>
                    </div>
                    <div class="form-group">
                        <label for="alertaEstoque">Alerta de Estoque Baixo (Itens)</label>
                        <input type="number" id="alertaEstoque" min="1" value="5" required>
                    </div>
                </div>
                <div class="action-buttons">
                    <button onclick="salvarConfiguracoes()" class="btn btn-primary">
                        <i class="fas fa-save"></i> Salvar Configura√ß√µes
                    </button>
                </div>
            </div>

            
        </div>
    </main>

    <div id="notification-area"></div>
    <input type="file" id="importFile" accept="application/json" style="display: none;" onchange="processarImportacao(event)">

    <script src="script.js"></script> 
</body>
</html>
